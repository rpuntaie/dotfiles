#!/usr/bin/bash

url=https://github.com/rpuntaie/dotfiles
from_url=true
if [[ "$0" =~ .*install ]]; then
  from_url=false
fi
cd ~
if [[ from_url ]]; then
  rm -f .pam_environment
  rm -rf .xmonad
  rm -rf .local
fi
if [[ -d dotfiles ]]; then
  cd dotfiles
  if [[ ! "$(git config --get remote.origin.url)"=="$url" ]]; then
    exit 1
  fi
  stow -D varlib
  stow -D bin
  stow -D etc
  stow -D home
  cd ..
  if [[ from_url ]]; then
    rm -rf dotfiles
    git clone $url
  fi
fi
mkdir -p .local/etc
mkdir -p .local/bin
mkdir -p .local/opt
mkdir -p .local/run
mkdir -p .local/var/log
mkdir -p .local/var/lib
mkdir -p .local/var/lib/gnupg
chmod 700 .local/var/lib/gnupg
mkdir -p .local/var/cache
cd dotfiles
stow home
stow -t ../.local/etc etc
stow -t ../.local/bin bin
stow -t ../.local/var/lib varlib
cd ..
ln -sf .local/etc/xmonad .xmonad
xmonad --recompile
echo -e "\033[0;31mPlease log out and in, to activate the environment."
