#!/usr/bin/env sh

# Note, the variable in .pam_environment cannot be used here

umask 077

cd ~

mkdir -p ~/my
mkdir -p ~/my/task
mkdir -p ~/my/finance
mkdir -p ~/.gnupg
mkdir -p ~/.password-store

#at least the vim config for Windows:
#bash dotfiles/bin/restowdots
if [[ ! $(uname) =~ "Linux" ]]; then
    rsync -av ~/dotfiles/etc/vim/ ~/vimfiles/
    exit 0
fi

#keep ~/.gnupg separate, just link the config file
for gpgfile in $(ls ~/dotfiles/etc/gnupg); do
    ln -sf ~/dotfiles/etc/gnupg/$gpgfile ~/.gnupg/$gpgfile
done

rm -rf ~/.local/etc/user-dirs*
stow --ignore=home --no-folding ${1:--R} -t ~/.local ~/dotfiles

# dot files for programs not heeding XDG_Base_Directory are symlinked to ``~/dotfiles/home``
# ~/.ledgerrc
# ~/.pam_environment
cd ~/dotfiles
stow home
cd ~

rm -rf ~/.xmonad
ln -sf ~/.local/etc/xmonad .xmonad
xmonad --recompile

#see ~/dotfiles/etc/user-dirs.dirs
for adir in $(sed -n -e 's,^X.*/\(.*\)",\1,p' .local/etc/user-dirs.dirs); do
    mkdir -p ~/$adir
done
xdg-user-dirs-update #sets non-existing dirs to homedir
