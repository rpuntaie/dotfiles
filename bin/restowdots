#!/usr/bin/env sh

# Note, the variable in .pam_environment cannot be used here

if [[ -f /usr/bin/stow ]]; then
    echo "you need to do: sudo pacman -S stow" >&2 && exit
end

if [[ -f /usr/bin/xdg-user-dirs-update ]]; then
    echo "you need to do: sudo pacman -S xdg-user-dirs" >&2 && exit
end

umask 077
mkdir -p $HOME/my
mkdir -p $HOME/my/task
mkdir -p $HOME/my/finance
mkdir -p $HOME/.gnupg
mkdir -p $HOME/.password-store

cd ~

#keep ~/.gnupg separate, just link the config file
for gpgfile in $(ls ~/dotfiles/etc/gnupg); do
    ln -sf ~/dotfiles/etc/gnupg/$gpgfile ~/.gnupg/$gpgfile
done

stow --ignore=home --no-folding ${1:--R} -t .local dotfiles
cd dotfiles

# dot files for programs not heeding XDG_Base_Directory are symlinked to ``~/dotfiles/home``
# ~/.ledgerrc
# ~/.pam_environment
stow home

cd ~

rm -rf .xmonad
ln -sf ~/.local/etc/xmonad .xmonad
xmonad --recompile

#see ~/dotfiles/etc/user-dirs.dirs
for adir in $(sed -n -e 's,^X.*/\(.*\)",\1,p' .local/etc/user-dirs.dirs); do
    mkdir -p $HOME/$adir
done
xdg-user-dirs-update #sets non-existing dirs to homedir
