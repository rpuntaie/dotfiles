#!/usr/bin/env bash

: ' copy private key to other pc
email is that from
git config --global --get user.email

    arguments:
    optionally ip of destination computer
    optionally user on destination computer if different

'

email=$(git config --global --get user.email)
topc=$1
touser=${2:-$USER}
echo "secret key .asc of $email"
echo "is copied to $topc"
echo "/home/$touser"

if [ -z "$topc" ]
then
    gpg2 --export-secret-keys -a -o $email.asc $email
    echo "When done, remove the private key $email.asc"
    exit 0
fi

if pushd $(mktemp -d || echo BADTMPDIR) > /dev/null
then
    gpg2 --export-secret-keys -a -o $email.asc $email
    scp $email.asc $touser@$topc:/home/$touser/$email.asc

	rm -r $(pwd)
    echo "on the other computer do"
    echo "cd && gpg2 --import $email.asc && rm $email.asc"
	popd > /dev/null
    exit 0
fi


